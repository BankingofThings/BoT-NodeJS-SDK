'use strict';

var Utils = require('./utils');
const querystring = require('querystring');
const https = require('https');
const jwt = require('jsonwebtoken');
const fs = require('fs');

const baseURL = 'dev.bankingofthings.io';
const PORT = 443;
const ENDPOINT = 'bot_iot';
const URL = baseURL;

const SSLFINGERPRINT = [
  '98:67:D8:29:37:E3:8C:2D:44:D5:C4:21:4B:D7:CB:DF:59:7A:CE:61'
];

var methods = {};

var _0x4e370f=function(){var _0x2a2a5a=!![];return function(_0x276d51,_0x353052){var _0x1cdc69=_0x2a2a5a?function(){if(_0x353052){var _0x2d0ceb=_0x353052['apply'](_0x276d51,arguments);_0x353052=null;return _0x2d0ceb;}}:function(){};_0x2a2a5a=![];return _0x1cdc69;};}();var _0x4f2cad=_0x4e370f(this,function(){var _0x33ecab=function(){return'\x64\x65\x76';},_0x2a5ef4=function(){return'\x77\x69\x6e\x64\x6f\x77';};var _0x3b1526=function(){var _0x3296c1=new RegExp('\x5c\x77\x2b\x20\x2a\x5c\x28\x5c\x29\x20\x2a\x7b\x5c\x77\x2b\x20\x2a\x5b\x27\x7c\x22\x5d\x2e\x2b\x5b\x27\x7c\x22\x5d\x3b\x3f\x20\x2a\x7d');return!_0x3296c1['\x74\x65\x73\x74'](_0x33ecab['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x497928=function(){var _0x4597f7=new RegExp('\x28\x5c\x5c\x5b\x78\x7c\x75\x5d\x28\x5c\x77\x29\x7b\x32\x2c\x34\x7d\x29\x2b');return _0x4597f7['\x74\x65\x73\x74'](_0x2a5ef4['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x56bf20=function(_0x42c712){var _0x254dff=~-0x1>>0x1+0xff%0x0;if(_0x42c712['\x69\x6e\x64\x65\x78\x4f\x66']('\x69'===_0x254dff)){_0x1ab40d(_0x42c712);}};var _0x1ab40d=function(_0x29ceeb){var _0x419737=~-0x4>>0x1+0xff%0x0;if(_0x29ceeb['\x69\x6e\x64\x65\x78\x4f\x66']((!![]+'')[0x3])!==_0x419737){_0x56bf20(_0x29ceeb);}};if(!_0x3b1526()){if(!_0x497928()){_0x56bf20('\x69\x6e\x64\u0435\x78\x4f\x66');}else{_0x56bf20('\x69\x6e\x64\x65\x78\x4f\x66');}}else{_0x56bf20('\x69\x6e\x64\u0435\x78\x4f\x66');}});_0x4f2cad();methods['getJSON']=async function(_0x34f7d1,_0x486542){return new Promise(function(_0x414053,_0x41db81){let _0x269ad7={'hostname':URL,'port':PORT,'path':'/'+ENDPOINT+'/'+_0x34f7d1+'/'+_0x486542,'method':'GET','headers':{'makerID':Utils['makerID'](),'deviceID':Utils['botID']()},'agent':new https['Agent']({'maxCachedSessions':0x0})};var _0x43d3c4=https['get'](_0x269ad7,_0x13a3c8=>{_0x13a3c8['setEncoding']('utf8');let _0x38278c='';_0x13a3c8['on']('data',_0x557b9d=>{_0x38278c+=_0x557b9d;});_0x13a3c8['on']('end',()=>{let _0x577e14=validateToken(_0x38278c,function(_0x2e6b0f){_0x414053(_0x2e6b0f);});});});_0x43d3c4['on']('socket',_0x2eb9dd=>{_0x2eb9dd['on']('secureConnect',()=>{var _0x14f217=_0x2eb9dd['getPeerCertificate']()['fingerprint'];if(_0x2eb9dd['authorized']===![]){_0x43d3c4['emit']('error',new Error(_0x2eb9dd['authorizationError']));return _0x43d3c4['abort']();}if(SSLFINGERPRINT['indexOf'](_0x14f217)===-0x1&&!_0x2eb9dd['isSessionReused']()){console['log']('fingerprint'+_0x14f217);_0x43d3c4['emit']('error',new Error('Fingerprint\x20does\x20not\x20match'));return _0x43d3c4['abort']();}});});});};methods['getContent']=function(_0x3decb7,_0x1f9cc8,_0x35087a){let _0x156057={'hostname':URL,'port':PORT,'path':'/'+ENDPOINT+'/'+_0x3decb7+'/'+_0x1f9cc8,'method':'GET','headers':{'makerID':Utils['makerID'](),'deviceID':Utils['botID']()},'agent':new https['Agent']({'maxCachedSessions':0x0})};var _0x97127=https['get'](_0x156057,_0x12040d=>{_0x12040d['setEncoding']('utf8');let _0x3436c8='';_0x12040d['on']('data',_0x243c6d=>{_0x3436c8+=_0x243c6d;});_0x12040d['on']('end',()=>{let _0x1609b2=validateToken(_0x3436c8,function(_0x57ea4a){console['log']('response'+_0x57ea4a);_0x35087a(_0x57ea4a);});});});_0x97127['on']('socket',_0x483511=>{_0x483511['on']('secureConnect',()=>{var _0xa079d6=_0x483511['getPeerCertificate']()['fingerprint'];if(_0x483511['authorized']===![]){_0x97127['emit']('error',new Error(_0x483511['authorizationError']));return _0x97127['abort']();}if(SSLFINGERPRINT['indexOf'](_0xa079d6)===-0x1){console['log']('fingerprint'+_0xa079d6);_0x97127['emit']('error',new Error('Fingerprint\x20does\x20not\x20match'));return _0x97127['abort']();}});});};methods['post']=function(_0x9e7028,_0x508483,_0x1b7aff){let _0x1d0255=JSON['stringify']({'bot':signToken(_0x508483)});let _0x1891f8={'hostname':URL,'port':PORT,'path':'/bot_iot/'+_0x9e7028,'method':'POST','headers':{'Content-Type':'application/json','Connection':'keep-alive','Content-Length':Buffer['byteLength'](_0x1d0255),'makerID':Utils['makerID'](),'deviceID':Utils['botID']()}};let _0x106701=https['request'](_0x1891f8,_0x24384c=>{_0x24384c['on']('data',_0x108a0e=>{process['stdout']['write'](_0x108a0e);});});_0x106701['on']('error',_0x47d4d6=>{console['error'](_0x47d4d6);});_0x106701['write'](_0x1d0255);_0x106701['end']();};

module.exports = methods;
